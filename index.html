<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥åœ°æ–½å·¥ç®¡ç†ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #FF6B35;
            border-bottom: 3px solid #FF6B35;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 40px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #FF6B35;
        }

        .form-section h3 {
            color: #FF6B35;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 14px;
        }

        .data-table th,
        .data-table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            font-size: 13px;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            padding: 6px 12px;
            font-size: 12px;
            margin: 2px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #FF6B35;
        }

        .stats-number {
            font-size: 28px;
            font-weight: bold;
            color: #FF6B35;
            margin-bottom: 10px;
        }

        .stats-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box, .filter-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
        }

        .search-box {
            min-width: 300px;
            flex: 1;
        }

        .filter-select {
            min-width: 150px;
        }

        .search-box:focus, .filter-select:focus {
            outline: none;
            border-color: #FF6B35;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .material-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .material-item input {
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 4px;
            margin: 0;
        }

        .material-item .remove-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .add-material-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .date-today {
            background: #FF6B35;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ å·¥åœ°æ–½å·¥ç®¡ç†ç³»çµ±</h1>
            <p>è¨˜éŒ„æ¯æ—¥æ–½å·¥é€²åº¦ã€äººåŠ›é…ç½®èˆ‡ææ–™ç®¡ç†</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">ğŸ“ æ¯æ—¥æ–½å·¥è¨˜éŒ„</button>
            <button class="tab" onclick="switchTab('manage')">ğŸ“‹ æ–½å·¥æ•¸æ“šç®¡ç†</button>
            <button class="tab" onclick="switchTab('stats')">ğŸ“ˆ é€²åº¦çµ±è¨ˆåˆ†æ</button>
        </div>

        <!-- æ¯æ—¥æ–½å·¥è¨˜éŒ„é é¢ -->
        <div id="daily-tab" class="tab-content active">
            <form id="constructionForm">
                <!-- åŸºæœ¬è³‡è¨Šå€åŸŸ -->
                <div class="form-section">
                    <h3>ğŸ—“ï¸ åŸºæœ¬è³‡è¨Š</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectName">å·¥ç¨‹åç¨± *</label>
                            <input type="text" id="projectName" name="projectName" placeholder="è«‹è¼¸å…¥å·¥ç¨‹åç¨±" required>
                        </div>
                        <div class="form-group">
                            <label for="date">æ–½å·¥æ—¥æœŸ *</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="weather">å¤©æ°£ç‹€æ³</label>
                            <select id="weather" name="weather">
                                <option value="">è«‹é¸æ“‡å¤©æ°£</option>
                                <option value="æ™´å¤©">â˜€ï¸ æ™´å¤©</option>
                                <option value="å¤šé›²">â›… å¤šé›²</option>
                                <option value="é™°å¤©">â˜ï¸ é™°å¤©</option>
                                <option value="å°é›¨">ğŸŒ¦ï¸ å°é›¨</option>
                                <option value="å¤§é›¨">ğŸŒ§ï¸ å¤§é›¨</option>
                                <option value="é¢±é¢¨">ğŸŒ€ é¢±é¢¨</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="supervisor">ç›£å·¥äººå“¡</label>
                            <input type="text" id="supervisor" name="supervisor" placeholder="è«‹è¼¸å…¥ç›£å·¥å§“å">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shift">æ–½å·¥ç­æ¬¡</label>
                            <select id="shift" name="shift">
                                <option value="">è«‹é¸æ“‡ç­æ¬¡</option>
                                <option value="æ—¥ç­">ğŸŒ… æ—¥ç­ (08:00-17:00)</option>
                                <option value="å¤œç­">ğŸŒ™ å¤œç­ (20:00-05:00)</option>
                                <option value="å…¨æ—¥ç­">â° å…¨æ—¥ç­</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="location">æ–½å·¥åœ°é»</label>
                            <input type="text" id="location" name="location" placeholder="è«‹è¼¸å…¥æ–½å·¥åœ°é»">
                        </div>
                    </div>
                </div>

                <!-- æ–½å·¥é …ç›®å€åŸŸ -->
                <div class="form-section">
                    <h3>ğŸ”¨ æ–½å·¥é …ç›®èˆ‡é€²åº¦</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="workItem">æ–½å·¥é …ç›® *</label>
                            <select id="workItem" name="workItem" required>
                                <option value="">è«‹é¸æ“‡æ–½å·¥é …ç›®</option>
                                <option value="åŸºç¤å·¥ç¨‹">ğŸ—ï¸ åŸºç¤å·¥ç¨‹</option>
                                <option value="é‹¼ç­‹å·¥ç¨‹">ğŸ”— é‹¼ç­‹å·¥ç¨‹</option>
                                <option value="æ··å‡åœŸå·¥ç¨‹">ğŸ§± æ··å‡åœŸå·¥ç¨‹</option>
                                <option value="æ¨¡æ¿å·¥ç¨‹">ğŸ“ æ¨¡æ¿å·¥ç¨‹</option>
                                <option value="ç Œç£šå·¥ç¨‹">ğŸ§± ç Œç£šå·¥ç¨‹</option>
                                <option value="æ°´é›»å·¥ç¨‹">âš¡ æ°´é›»å·¥ç¨‹</option>
                                <option value="æ²¹æ¼†å·¥ç¨‹">ğŸ¨ æ²¹æ¼†å·¥ç¨‹</option>
                                <option value="è£ä¿®å·¥ç¨‹">ğŸ”§ è£ä¿®å·¥ç¨‹</option>
                                <option value="å…¶ä»–">â“ å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="workDetail">æ–½å·¥ç´°é …</label>
                            <input type="text" id="workDetail" name="workDetail" placeholder="ä¾‹å¦‚ï¼šä¸€æ¨“æŸ±å­æ¾†ç½®">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="completedQuantity">å®Œæˆæ•¸é‡ *</label>
                            <input type="number" id="completedQuantity" name="completedQuantity" min="0" step="0.1" placeholder="è«‹è¼¸å…¥å®Œæˆæ•¸é‡" required>
                        </div>
                        <div class="form-group">
                            <label for="unit">å–®ä½</label>
                            <select id="unit" name="unit">
                                <option value="">è«‹é¸æ“‡å–®ä½</option>
                                <option value="ç«‹æ–¹ç±³">ç«‹æ–¹ç±³ (mÂ³)</option>
                                <option value="å¹³æ–¹ç±³">å¹³æ–¹ç±³ (mÂ²)</option>
                                <option value="å…¬å°º">å…¬å°º (m)</option>
                                <option value="æ”¯">æ”¯</option>
                                <option value="çµ„">çµ„</option>
                                <option value="å¼">å¼</option>
                                <option value="æ‰¹">æ‰¹</option>
                                <option value="é …">é …</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- äººåŠ›é…ç½®å€åŸŸ -->
                <div class="form-section">
                    <h3>ğŸ‘· äººåŠ›é…ç½®</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="totalWorkers">ç¸½å‡ºå·¥äººæ•¸ *</label>
                            <input type="number" id="totalWorkers" name="totalWorkers" min="0" placeholder="è«‹è¼¸å…¥ç¸½äººæ•¸" required>
                        </div>
                        <div class="form-group">
                            <label for="skilledWorkers">æŠ€è¡“å·¥äººæ•¸</label>
                            <input type="number" id="skilledWorkers" name="skilledWorkers" min="0" placeholder="æŠ€è¡“å·¥äººæ•¸">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="laborWorkers">æ™®å·¥äººæ•¸</label>
                            <input type="number" id="laborWorkers" name="laborWorkers" min="0" placeholder="æ™®å·¥äººæ•¸">
                        </div>
                        <div class="form-group">
                            <label for="overtimeHours">åŠ ç­æ™‚æ•¸</label>
                            <input type="number" id="overtimeHours" name="overtimeHours" min="0" step="0.5" placeholder="åŠ ç­æ™‚æ•¸">
                        </div>
                    </div>
                </div>

               <!-- ææ–™é€²å ´å€åŸŸ -->
                <div class="form-section">
                  <h3>ğŸ“¦ ææ–™é€²å ´è¨˜éŒ„</h3>
                  <button type="button" class="add-material-btn" onclick="addMaterialItem()">+ æ–°å¢ææ–™</button>
                  <div id="materialsList">
                    <div class="material-item">
                      <input type="text" placeholder="ææ–™åç¨±" name="materialName[]">
                      <input type="number" placeholder="æ•¸é‡" name="materialQuantity[]" min="0" step="0.1">
                      <input type="text" placeholder="å–®ä½" name="materialUnit[]">
                      <input type="text" placeholder="ä¾›æ‡‰å•†" name="materialSupplier[]">
                      <button type="button" class="remove-btn" onclick="removeMaterialItem(this)">åˆªé™¤</button>
                    </div>
                  </div>
                </div>
                
                <style>
                  /* ææ–™å€å¡Šçš„æ¨£å¼ */
                  .material-item {
                    display: flex;
                    flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
                    gap: 8px;
                    margin-bottom: 12px;
                  }
                
                  .material-item input {
                    flex: 1 1 100%; /* é è¨­æ‰‹æ©Ÿä¸€è¡Œä¸€å€‹ */
                    padding: 8px;
                    font-size: 16px;
                    box-sizing: border-box;
                  }
                
                  .remove-btn {
                    flex: 1 1 100%; /* é è¨­æ‰‹æ©Ÿè®“åˆªé™¤æŒ‰éˆ•ç¨ç«‹ä¸€è¡Œ */
                    padding: 8px;
                    font-size: 14px;
                    background: #f44336;
                    color: #fff;
                    border: none;
                    border-radius: 6px;
                  }
                
                  /* å¹³æ¿/é›»è…¦æ‰æ©«å‘æ’ç‰ˆ */
                  @media (min-width: 768px) {
                    .material-item input[name="materialName[]"] {
                      flex: 2;
                    }
                    .material-item input[name="materialQuantity[]"] {
                      flex: 1;
                    }
                    .material-item input[name="materialUnit[]"] {
                      flex: 1;
                    }
                    .material-item input[name="materialSupplier[]"] {
                      flex: 1.5;
                    }
                    .remove-btn {
                      flex: 0 0 auto; /* ä¸è¦æ’æ»¿ */
                    }
                  }
                </style>


                <!-- å‚™è¨»å€åŸŸ -->
                <div class="form-section">
                    <h3>ğŸ“ å‚™è¨»èªªæ˜</h3>
                    <div class="form-group">
                        <label for="notes">æ–½å·¥å‚™è¨»</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="è«‹è¼¸å…¥æ–½å·¥ç‹€æ³ã€å•é¡Œæˆ–ç‰¹æ®Šäº‹é …..."></textarea>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button type="button" class="btn btn-primary" onclick="addConstructionData()">ğŸ’¾ å„²å­˜æ–½å·¥è¨˜éŒ„</button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ æ¸…ç©ºè¡¨å–®</button>
                </div>
            </form>

            <div id="alert-container"></div>
        </div>

        <!-- æ–½å·¥æ•¸æ“šç®¡ç†é é¢ -->
        <div id="manage-tab" class="tab-content">
            <div class="search-filter-bar">
                <input type="text" class="search-box" id="searchInput" placeholder="ğŸ” æœå°‹æ–½å·¥é …ç›®ã€ç›£å·¥äººå“¡..." onkeyup="searchData()">
                <select class="filter-select" id="itemFilter" onchange="filterData()">
                    <option value="">å…¨éƒ¨é …ç›®</option>
                </select>
                <select class="filter-select" id="dateFilter" onchange="filterData()">
                    <option value="">å…¨éƒ¨æ—¥æœŸ</option>
                    <option value="today">ä»Šæ—¥</option>
                    <option value="week">æœ¬é€±</option>
                    <option value="month">æœ¬æœˆ</option>
                </select>
                <div>
                    <button class="btn btn-success" onclick="exportToExcel()">ğŸ“Š åŒ¯å‡ºExcel</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºè³‡æ–™</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>ç·¨è™Ÿ</th>
                            <th>å·¥ç¨‹åç¨±</th>
                            <th>æ—¥æœŸ</th>
                            <th>æ–½å·¥é …ç›®</th>
                            <th>å®Œæˆæ•¸é‡</th>
                            <th>å‡ºå·¥äººæ•¸</th>
                            <th>å¤©æ°£</th>
                            <th>ç›£å·¥</th>
                            <th>ææ–™é€²å ´</th>
                            <th>è¨˜éŒ„æ™‚é–“</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
                
                <div id="emptyState" class="empty-state">
                    <div style="font-size: 48px;">ğŸ—ï¸</div>
                    <h3>å°šæœªæœ‰æ–½å·¥è¨˜éŒ„</h3>
                    <p>é»æ“Šã€Œæ¯æ—¥æ–½å·¥è¨˜éŒ„ã€é–‹å§‹è¨˜éŒ„ç¬¬ä¸€ç­†æ–½å·¥è³‡æ–™</p>
                </div>
            </div>
        </div>

        <!-- é€²åº¦çµ±è¨ˆåˆ†æé é¢ -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-grid" id="statsGrid">
                <div class="stats-card">
                    <div class="stats-number" id="totalRecords">0</div>
                    <div class="stats-label">ç¸½æ–½å·¥è¨˜éŒ„</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalWorkers">0</div>
                    <div class="stats-label">ç´¯è¨ˆå‡ºå·¥äººæ•¸</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="avgWorkersPerDay">0</div>
                    <div class="stats-label">æ—¥å‡å‡ºå·¥äººæ•¸</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalMaterials">0</div>
                    <div class="stats-label">ææ–™é€²å ´æ‰¹æ¬¡</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸ“ˆ æ–½å·¥é …ç›®çµ±è¨ˆ</h3>
                    <div id="workItemStats"></div>
                </div>

                <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">ğŸŒ¤ï¸ å¤©æ°£å½±éŸ¿åˆ†æ</h3>
                    <div id="weatherStats"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™å„²å­˜åœ¨localStorageä¸­
        let constructionData = JSON.parse(localStorage.getItem('constructionData') || '[]');
        let currentEditId = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­å®šä»Šæ—¥æ—¥æœŸç‚ºé è¨­å€¼
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            loadAllData();
            updateStats();
            updateFilters();
        });

        // åˆ‡æ›åˆ†é 
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'stats') {
                updateStats();
            }
        }

        // æ–°å¢ææ–™é …ç›®
        function addMaterialItem() {
            const materialsList = document.getElementById('materialsList');
            const materialItem = document.createElement('div');
            materialItem.className = 'material-item';
            materialItem.innerHTML = `
                <input type="text" placeholder="ææ–™åç¨±" name="materialName[]" style="flex: 2;">
                <input type="number" placeholder="æ•¸é‡" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
                <input type="text" placeholder="å–®ä½" name="materialUnit[]" style="flex: 1;">
                <input type="text" placeholder="ä¾›æ‡‰å•†" name="materialSupplier[]" style="flex: 1.5;">
                <button type="button" class="remove-btn" onclick="removeMaterialItem(this)">åˆªé™¤</button>
            `;
            materialsList.appendChild(materialItem);
        }

        // ç§»é™¤ææ–™é …ç›®
        function removeMaterialItem(button) {
            const materialsList = document.getElementById('materialsList');
            if (materialsList.children.length > 1) {
                button.parentElement.remove();
            } else {
                showAlert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹ææ–™é …ç›®ï¼', 'danger');
            }
        }

        // æ–°å¢æ–½å·¥è³‡æ–™
        function addConstructionData() {
            const form = document.getElementById('constructionForm');
            
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!form.projectName.value || !form.date.value || !form.workItem.value || !form.completedQuantity.value || !form.totalWorkers.value) {
                showAlert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼ˆæ¨™ç¤º*è€…ï¼‰ï¼', 'danger');
                return;
            }

            // æ”¶é›†ææ–™è³‡æ–™
            const materialNames = form.querySelectorAll('input[name="materialName[]"]');
            const materialQuantities = form.querySelectorAll('input[name="materialQuantity[]"]');
            const materialUnits = form.querySelectorAll('input[name="materialUnit[]"]');
            const materialSuppliers = form.querySelectorAll('input[name="materialSupplier[]"]');
            
            const materials = [];
            for (let i = 0; i < materialNames.length; i++) {
                if (materialNames[i].value.trim()) {
                    materials.push({
                        name: materialNames[i].value,
                        quantity: materialQuantities[i].value || 0,
                        unit: materialUnits[i].value || '',
                        supplier: materialSuppliers[i].value || ''
                    });
                }
            }

            const data = {
                id: currentEditId || Date.now().toString(),
                projectName: form.projectName.value,
                date: form.date.value,
                weather: form.weather.value,
                supervisor: form.supervisor.value,
                shift: form.shift.value,
                location: form.location.value,
                workItem: form.workItem.value,
                workDetail: form.workDetail.value,
                completedQuantity: parseFloat(form.completedQuantity.value),
                unit: form.unit.value,
                totalWorkers: parseInt(form.totalWorkers.value),
                skilledWorkers: parseInt(form.skilledWorkers.value) || 0,
                laborWorkers: parseInt(form.laborWorkers.value) || 0,
                overtimeHours: parseFloat(form.overtimeHours.value) || 0,
                materials: materials,
                notes: form.notes.value,
                createTime: new Date().toLocaleString('zh-TW')
            };

            if (currentEditId) {
                const index = constructionData.findIndex(item => item.id === currentEditId);
                constructionData[index] = data;
                showAlert('æ–½å·¥è¨˜éŒ„æ›´æ–°æˆåŠŸï¼', 'success');
                currentEditId = null;
            } else {
                constructionData.push(data);
                showAlert('æ–½å·¥è¨˜éŒ„å„²å­˜æˆåŠŸï¼', 'success');
            }

            localStorage.setItem('constructionData', JSON.stringify(constructionData));
            
            loadAllData();
            updateStats();
            updateFilters();
            clearForm();
        }

        // è¼‰å…¥æ‰€æœ‰è³‡æ–™
        function loadAllData() {
            const tbody = document.getElementById('dataTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (constructionData.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = constructionData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.date}</td>
                    <td>${item.workItem}${item.workDetail ? '<br><small>' + item.workDetail + '</small>' : ''}</td>
                    <td>${item.completedQuantity} ${item.unit || ''}</td>
                    <td>${item.totalWorkers}äºº${item.overtimeHours ? '<br><small>åŠ ç­' + item.overtimeHours + 'h</small>' : ''}</td>
                    <td>${item.weather || '-'}</td>
                    <td>${item.supervisor || '-'}</td>
                    <td>${item.materials.length}é …</td>
                    <td>${item.createTime}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="viewDetails('${item.id}')">è©³æƒ…</button>
                            <button class="btn btn-danger" onclick="deleteData('${item.id}')">åˆªé™¤</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // æŸ¥çœ‹è©³æƒ…
        function viewDetails(id) {
            const item = constructionData.find(data => data.id === id);
            if (!item) return;

            let materialsInfo = '';
            if (item.materials && item.materials.length > 0) {
                materialsInfo = item.materials.map(m => 
                    `${m.name}: ${m.quantity} ${m.unit} (${m.supplier || 'æœªæŒ‡å®šä¾›æ‡‰å•†'})`
                ).join('\n');
            } else {
                materialsInfo = 'ç„¡ææ–™è¨˜éŒ„';
            }

            const details = `
å·¥ç¨‹åç¨±: ${item.projectName || 'æœªæŒ‡å®š'}
æ–½å·¥æ—¥æœŸ: ${item.date}
æ–½å·¥åœ°é»: ${item.location || 'æœªè¨˜éŒ„'}
å¤©æ°£ç‹€æ³: ${item.weather || 'æœªè¨˜éŒ„'}
ç›£å·¥äººå“¡: ${item.supervisor || 'æœªæŒ‡å®š'}
æ–½å·¥ç­æ¬¡: ${item.shift || 'æœªæŒ‡å®š'}

æ–½å·¥é …ç›®: ${item.workItem}
æ–½å·¥ç´°é …: ${item.workDetail || 'ç„¡'}
å®Œæˆæ•¸é‡: ${item.completedQuantity} ${item.unit || ''}

äººåŠ›é…ç½®:
- ç¸½å‡ºå·¥äººæ•¸: ${item.totalWorkers}äºº
- æŠ€è¡“å·¥äºº: ${item.skilledWorkers || 0}äºº
- æ™®å·¥: ${item.laborWorkers || 0}äºº
- åŠ ç­æ™‚æ•¸: ${item.overtimeHours || 0}å°æ™‚

ææ–™é€²å ´:
${materialsInfo}

å‚™è¨»: ${item.notes || 'ç„¡'}
            `;

            alert(details);
        }

        // ç·¨è¼¯è³‡æ–™
        function editData(id) {
            const item = constructionData.find(data => data.id === id);
            if (!item) return;

            const form = document.getElementById('constructionForm');
            form.projectName.value = item.projectName || '';
            form.date.value = item.date;
            form.weather.value = item.weather || '';
            form.supervisor.value = item.supervisor || '';
            form.shift.value = item.shift || '';
            form.location.value = item.location || '';
            form.workItem.value = item.workItem;
            form.workDetail.value = item.workDetail || '';
            form.completedQuantity.value = item.completedQuantity;
            form.unit.value = item.unit || '';
            form.totalWorkers.value = item.totalWorkers;
            form.skilledWorkers.value = item.skilledWorkers || '';
            form.laborWorkers.value = item.laborWorkers || '';
            form.overtimeHours.value = item.overtimeHours || '';
            form.notes.value = item.notes || '';

            // è¼‰å…¥ææ–™è³‡æ–™
            const materialsList = document.getElementById('materialsList');
            materialsList.innerHTML = '';
            
            if (item.materials && item.materials.length > 0) {
                item.materials.forEach(material => {
                    const materialItem = document.createElement('div');
                    materialItem.className = 'material-item';
                    materialItem.innerHTML = `
                        <input type="text" placeholder="ææ–™åç¨±" name="materialName[]" value="${material.name}" style="flex: 2;">
                        <input type="number" placeholder="æ•¸é‡" name="materialQuantity[]" value="${material.quantity}" min="0" step="0.1" style="flex: 1;">
                        <input type="text" placeholder="å–®ä½" name="materialUnit[]" value="${material.unit}" style="flex: 1;">
                        <input type="text" placeholder="ä¾›æ‡‰å•†" name="materialSupplier[]" value="${material.supplier}" style="flex: 1.5;">
                        <button type="button" class="remove-btn" onclick="removeMaterialItem(this)">åˆªé™¤</button>
                    `;
                    materialsList.appendChild(materialItem);
                });
            } else {
                // å¦‚æœæ²’æœ‰ææ–™è¨˜éŒ„ï¼Œæ·»åŠ ä¸€å€‹ç©ºçš„ææ–™é …ç›®
                addMaterialItem();
            }

            currentEditId = id;
            switchTab('daily');
            
            showAlert('è³‡æ–™è¼‰å…¥å®Œæˆï¼Œä¿®æ”¹å¾Œè«‹é»æ“Šå„²å­˜', 'success');
        }

        // åˆªé™¤è³‡æ–™
        function deleteData(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†æ–½å·¥è¨˜éŒ„å—ï¼Ÿ')) return;
            
            constructionData = constructionData.filter(item => item.id !== id);
            localStorage.setItem('constructionData', JSON.stringify(constructionData));
            
            loadAllData();
            updateStats();
            updateFilters();
            showAlert('æ–½å·¥è¨˜éŒ„å·²åˆªé™¤', 'success');
        }

        // æœå°‹è³‡æ–™
        function searchData() {
            filterData();
        }

        // ç¯©é¸è³‡æ–™
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const itemFilter = document.getElementById('itemFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filteredData = constructionData;

            // æ–‡å­—æœå°‹
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    (item.projectName && item.projectName.toLowerCase().includes(searchTerm)) ||
                    item.workItem.toLowerCase().includes(searchTerm) ||
                    (item.workDetail && item.workDetail.toLowerCase().includes(searchTerm)) ||
                    (item.supervisor && item.supervisor.toLowerCase().includes(searchTerm)) ||
                    (item.location && item.location.toLowerCase().includes(searchTerm)) ||
                    (item.notes && item.notes.toLowerCase().includes(searchTerm))
                );
            }

            // é …ç›®ç¯©é¸
            if (itemFilter) {
                filteredData = filteredData.filter(item => item.workItem === itemFilter);
            }

            // æ—¥æœŸç¯©é¸
            if (dateFilter) {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                
                filteredData = filteredData.filter(item => {
                    const itemDate = new Date(item.date);
                    
                    switch(dateFilter) {
                        case 'today':
                            return item.date === todayStr;
                        case 'week':
                            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return itemDate >= weekAgo && itemDate <= today;
                        case 'month':
                            return itemDate.getMonth() === today.getMonth() && 
                                   itemDate.getFullYear() === today.getFullYear();
                        default:
                            return true;
                    }
                });
            }

            // æ›´æ–°è¡¨æ ¼é¡¯ç¤º
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = filteredData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.projectName || '-'}</td>
                    <td>${item.date}</td>
                    <td>${item.workItem}${item.workDetail ? '<br><small>' + item.workDetail + '</small>' : ''}</td>
                    <td>${item.completedQuantity} ${item.unit || ''}</td>
                    <td>${item.totalWorkers}äºº${item.overtimeHours ? '<br><small>åŠ ç­' + item.overtimeHours + 'h</small>' : ''}</td>
                    <td>${item.weather || '-'}</td>
                    <td>${item.supervisor || '-'}</td>
                    <td>${item.materials.length}é …</td>
                    <td>${item.createTime}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-warning" onclick="editData('${item.id}')">ç·¨è¼¯</button>
                            <button class="btn btn-secondary" onclick="viewDetails('${item.id}')">è©³æƒ…</button>
                            <button class="btn btn-danger" onclick="deleteData('${item.id}')">åˆªé™¤</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // æ›´æ–°ç¯©é¸é¸é …
        function updateFilters() {
            const itemFilter = document.getElementById('itemFilter');
            const workItems = [...new Set(constructionData.map(item => item.workItem))];
            
            const currentValue = itemFilter.value;
            itemFilter.innerHTML = '<option value="">å…¨éƒ¨é …ç›®</option>';
            
            workItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                itemFilter.appendChild(option);
            });
            
            itemFilter.value = currentValue;
        }

        // åŒ¯å‡ºåˆ°Excel
        function exportToExcel() {
            if (constructionData.length === 0) {
                showAlert('æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡ºï¼', 'danger');
                return;
            }

            const exportData = [];
            
            constructionData.forEach((item, index) => {
                const baseData = {
                    'ç·¨è™Ÿ': index + 1,
                    'å·¥ç¨‹åç¨±': item.projectName || '',
                    'æ–½å·¥æ—¥æœŸ': item.date,
                    'æ–½å·¥åœ°é»': item.location || '',
                    'å¤©æ°£ç‹€æ³': item.weather || '',
                    'ç›£å·¥äººå“¡': item.supervisor || '',
                    'æ–½å·¥ç­æ¬¡': item.shift || '',
                    'æ–½å·¥é …ç›®': item.workItem,
                    'æ–½å·¥ç´°é …': item.workDetail || '',
                    'å®Œæˆæ•¸é‡': item.completedQuantity,
                    'å–®ä½': item.unit || '',
                    'ç¸½å‡ºå·¥äººæ•¸': item.totalWorkers,
                    'æŠ€è¡“å·¥äººæ•¸': item.skilledWorkers || 0,
                    'æ™®å·¥äººæ•¸': item.laborWorkers || 0,
                    'åŠ ç­æ™‚æ•¸': item.overtimeHours || 0,
                    'ææ–™é …ç›®æ•¸': item.materials.length,
                    'å‚™è¨»': item.notes || '',
                    'è¨˜éŒ„æ™‚é–“': item.createTime
                };

                exportData.push(baseData);

                // å¦‚æœæœ‰ææ–™è³‡æ–™ï¼Œå¦å¤–å»ºç«‹ææ–™æ˜ç´°è¡¨
                if (item.materials && item.materials.length > 0) {
                    item.materials.forEach(material => {
                        exportData.push({
                            'ç·¨è™Ÿ': `${index + 1}-ææ–™`,
                            'æ–½å·¥æ—¥æœŸ': item.date,
                            'ææ–™åç¨±': material.name,
                            'ææ–™æ•¸é‡': material.quantity,
                            'ææ–™å–®ä½': material.unit,
                            'ä¾›æ‡‰å•†': material.supplier || ''
                        });
                    });
                }
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // è¨­å®šæ¬„ä½å¯¬åº¦
            const colWidths = [
                {wch: 8}, {wch: 12}, {wch: 10}, {wch: 12}, {wch: 12}, 
                {wch: 15}, {wch: 20}, {wch: 10}, {wch: 8}, {wch: 10},
                {wch: 10}, {wch: 10}, {wch: 10}, {wch: 8}, {wch: 30}, {wch: 18}
            ];
            ws['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(wb, ws, "æ–½å·¥è¨˜éŒ„");
            const fileName = `æ–½å·¥è¨˜éŒ„_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert('Excelæª”æ¡ˆå·²æˆåŠŸåŒ¯å‡ºï¼', 'success');
        }

        // æ›´æ–°çµ±è¨ˆè³‡æ–™
        function updateStats() {
            const totalRecords = constructionData.length;
            const totalWorkers = constructionData.reduce((sum, item) => sum + item.totalWorkers, 0);
            const avgWorkersPerDay = totalRecords > 0 ? Math.round(totalWorkers / totalRecords) : 0;
            const totalMaterials = constructionData.reduce((sum, item) => sum + item.materials.length, 0);

            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('totalWorkers').textContent = totalWorkers;
            document.getElementById('avgWorkersPerDay').textContent = avgWorkersPerDay;
            document.getElementById('totalMaterials').textContent = totalMaterials;

            // æ›´æ–°é …ç›®çµ±è¨ˆ
            updateWorkItemStats();
            updateWeatherStats();
        }

        // æ›´æ–°æ–½å·¥é …ç›®çµ±è¨ˆ
        function updateWorkItemStats() {
            const workItemStats = document.getElementById('workItemStats');
            
            if (constructionData.length === 0) {
                workItemStats.innerHTML = '<p style="text-align: center; color: #666;">æš«ç„¡æ–½å·¥æ•¸æ“š</p>';
                return;
            }

            const itemCounts = {};
            constructionData.forEach(item => {
                itemCounts[item.workItem] = (itemCounts[item.workItem] || 0) + 1;
            });

            const sortedItems = Object.entries(itemCounts)
                .sort(([,a], [,b]) => b - a)
                .map(([name, count]) => ({
                    name,
                    count,
                    percentage: Math.round((count / constructionData.length) * 100)
                }));

            workItemStats.innerHTML = sortedItems.map(item => `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${item.name}</span>
                        <span>${item.count} æ¬¡ (${item.percentage}%)</span>
                    </div>
                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px;">
                        <div style="background: #FF6B35; height: 8px; width: ${item.percentage}%; border-radius: 4px;"></div>
                    </div>
                </div>
            `).join('');
        }

        // æ›´æ–°å¤©æ°£çµ±è¨ˆ
        function updateWeatherStats() {
            const weatherStats = document.getElementById('weatherStats');
            
            const weatherData = constructionData.filter(item => item.weather);
            if (weatherData.length === 0) {
                weatherStats.innerHTML = '<p style="text-align: center; color: #666;">æš«ç„¡å¤©æ°£æ•¸æ“š</p>';
                return;
            }

            const weatherCounts = {};
            weatherData.forEach(item => {
                weatherCounts[item.weather] = (weatherCounts[item.weather] || 0) + 1;
            });

            const sortedWeather = Object.entries(weatherCounts)
                .sort(([,a], [,b]) => b - a)
                .map(([name, count]) => ({
                    name,
                    count,
                    percentage: Math.round((count / weatherData.length) * 100)
                }));

            weatherStats.innerHTML = sortedWeather.map(weather => `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${weather.name}</span>
                        <span>${weather.count} å¤© (${weather.percentage}%)</span>
                    </div>
                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px;">
                        <div style="background: #2196F3; height: 8px; width: ${weather.percentage}%; border-radius: 4px;"></div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸…ç©ºè¡¨å–®
        function clearForm() {
            document.getElementById('constructionForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            currentEditId = null;
            
            // é‡ç½®ææ–™åˆ—è¡¨
            const materialsList = document.getElementById('materialsList');
            materialsList.innerHTML = `
                <div class="material-item">
                    <input type="text" placeholder="ææ–™åç¨±" name="materialName[]" style="flex: 2;">
                    <input type="number" placeholder="æ•¸é‡" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
                    <input type="text" placeholder="å–®ä½" name="materialUnit[]" style="flex: 1;">
                    <input type="text" placeholder="ä¾›æ‡‰å•†" name="materialSupplier[]" style="flex: 1.5;">
                    <button type="button" class="remove-btn" onclick="removeMaterialItem(this)">åˆªé™¤</button>
                </div>
            `;
        }

        // æ¸…ç©ºæ‰€æœ‰è³‡æ–™
        function clearAllData() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ–½å·¥è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;
            
            constructionData = [];
            localStorage.removeItem('constructionData');
            loadAllData();
            updateStats();
            updateFilters();
            showAlert('æ‰€æœ‰æ–½å·¥è¨˜éŒ„å·²æ¸…ç©º', 'success');
        }

        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            alertContainer.appendChild(alertDiv);
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>



