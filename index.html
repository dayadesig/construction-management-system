<!-- 進度統計分析頁面 -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-grid" id="statsGrid">
                <div class="stats-card">
                    <div class="stats-number" id="totalRecords">0</div>
                    <div class="stats-label">總施工記錄</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalWorkers">0</div>
                    <div class="stats-label">累計出工人數</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="avgWorkersPerDay">0</div>
                    <div class="stats-label">日均出工人數</div>
                </div>
                <div class="stats-card">
                    <div class="stats-number" id="totalProjects">0</div>
                    <div class="stats-label">工程專案數</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">📈 施工項目統計</h3>
                    <div id="workItemStats"></div>
                </div>

                <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">🏗️ 工程專案進度</h3>
                    <div id="projectStats"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 連線狀態指示器 -->
    <div class="connection-status" id="connectionStatus">
        🔥 Firebase 已連線
    </div>

    <script>
        // 🔥 Firebase 設定 - 請替換成你的專案設定
        const firebaseConfig = {
            apiKey: "AIzaSyDxDEFXQdJdxKEcY__sAz2HroXDmtg8EQs",
            authDomain: "construction-management-4ebe2.firebaseapp.com",
            projectId: "construction-management-4ebe2",
            storageBucket: "construction-management-4ebe2.firebasestorage.app",
            messagingSenderId: "255668354731",
            appId: "1:255668354731:web:fcec0c02986b03ed4d41ee",
            measurementId: "G-MZF5XY3XKM"
        };


        const app = initializeApp(firebaseConfig);
  	const auth = getAuth(app);
  	const db = getFirestore(app);

  	console.log("🔥 Firebase 已連線");
        

        // 全域變數
        let currentUser = null;
        let constructionData = [];
        let currentEditId = null;
        let unsubscribe = null;

        // 應用程式初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔥 Firebase 初始化成功');
            console.log('🔧 Firebase Config:', firebaseConfig.projectId);
            
            // 設定今日日期
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            // 監聽認證狀態
            auth.onAuthStateChanged((user) => {
                console.log('🔐 認證狀態變更:', user ? '已登入' : '未登入');
                if (user) {
                    console.log('✅ 用戶資訊:', {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName
                    });
                    currentUser = user;
                    showMainApp();
                    loadUserData();
                    startRealtimeListener();
                } else {
                    console.log('❌ 用戶未登入');
                    currentUser = null;
                    showAuthContainer();
                }
            });

            // 設定表單事件
            setupFormEvents();
            
            // 監聽連線狀態
            monitorConnection();
        });

        // 設定表單事件
        function setupFormEvents() {
            // 登入表單
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await handleLogin();
            });

            // 註冊表單
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await handleSignup();
            });
        }

        // 處理登入
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');

            if (!email || !password) {
                showAlert('請填寫電子信箱和密碼！', 'danger');
                return;
            }

            try {
                loginBtn.disabled = true;
                loginBtn.textContent = '登入中...';
                showAuthLoading(true);

                await auth.signInWithEmailAndPassword(email, password);
                showAlert('登入成功！', 'success');
                
            } catch (error) {
                console.error('Login error:', error);
                let message = '登入失敗！';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        message = '找不到此帳號，請檢查電子信箱或先註冊。';
                        break;
                    case 'auth/wrong-password':
                        message = '密碼錯誤，請重新輸入。';
                        break;
                    case 'auth/invalid-email':
                        message = '電子信箱格式錯誤。';
                        break;
                    case 'auth/network-request-failed':
                        message = '網路連線失敗，請檢查網路連線。';
                        break;
                    default:
                        message = `登入失敗：${error.message}`;
                }
                
                showAlert(message, 'danger');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = '登入系統';
                showAuthLoading(false);
            }
        }

        // 處理註冊
        async function handleSignup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const phone = document.getElementById('signupPhone').value;
            const signupBtn = document.getElementById('signupBtn');

            console.log('📝 開始註冊流程:', { name, email });

            if (!name || !email || !password) {
                showAlert('請填寫必要資訊！', 'danger');
                return;
            }

            if (password.length < 6) {
                showAlert('密碼至少需要6個字元！', 'danger');
                return;
            }

            try {
                signupBtn.disabled = true;
                signupBtn.textContent = '註冊中...';
                showAuthLoading(true);

                console.log('🔐 正在創建用戶帳號...');
                // 創建帳號
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                console.log('✅ 帳號創建成功:', userCredential.user.uid);
                
                console.log('👤 正在更新用戶資料...');
                // 更新使用者資料
                await userCredential.user.updateProfile({
                    displayName: name
                });
                console.log('✅ 用戶資料更新成功');

                console.log('💾 正在儲存額外資訊到 Firestore...');
                // 儲存額外的使用者資訊到 Firestore
                await db.collection('users').add({
                    uid: userCredential.user.uid,
                    name: name,
                    email: email,
                    phone: phone || '',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('✅ 用戶資訊儲存成功');

                showAlert('註冊成功！歡迎使用工地管理系統。', 'success');
                console.log('🎉 註冊流程完成，等待認證狀態變更...');
                
            } catch (error) {
                console.error('❌ 註冊錯誤:', error);
                let message = '註冊失敗！';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        message = '此電子信箱已被註冊，請使用其他信箱或直接登入。';
                        break;
                    case 'auth/invalid-email':
                        message = '電子信箱格式錯誤。';
                        break;
                    case 'auth/weak-password':
                        message = '密碼強度太弱，請設定更複雜的密碼。';
                        break;
                    case 'auth/network-request-failed':
                        message = '網路連線失敗，請檢查網路連線。';
                        break;
                    case 'permission-denied':
                        message = '資料庫權限不足，請檢查 Firestore 規則設定。';
                        break;
                    default:
                        message = `註冊失敗：${error.message}`;
                }
                
                showAlert(message, 'danger');
            } finally {
                signupBtn.disabled = false;
                signupBtn.textContent = '註冊帳號';
                showAuthLoading(false);
            }
        }

        // 登出
        async function logout() {
            try {
                // 停止即時監聽
                if (unsubscribe) {
                    unsubscribe();
                    unsubscribe = null;
                }
                
                await auth.signOut();
                showAlert('已安全登出！', 'info');
                
                // 清空資料
                constructionData = [];
                currentEditId = null;
                
            } catch (error) {
                console.error('Logout error:', error);
                showAlert('登出失敗！', 'danger');
            }
        }

        // 顯示認證容器
        function showAuthContainer() {
            document.getElementById('auth-container').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
            hideConnectionStatus();
        }

        // 顯示主應用程式
        function showMainApp() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            showConnectionStatus();
        }

        // 載入使用者資料
        function loadUserData() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.displayName || '使用者';
                document.getElementById('userEmail').textContent = currentUser.email;
            }
        }

        // 開始即時監聽
        function startRealtimeListener() {
            if (!currentUser) return;
            
            showDataLoading(true);
            
            const query = db.collection('construction_records')
                .where('userId', '==', currentUser.uid)
                .orderBy('date', 'desc');
            
            unsubscribe = query.onSnapshot((snapshot) => {
                constructionData = [];
                snapshot.forEach((doc) => {
                    constructionData.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                console.log('📊 載入了', constructionData.length, '筆施工記錄');
                loadAllData();
                updateStats();
                updateFilters();
                showDataLoading(false);
            }, (error) => {
                console.error('Realtime listener error:', error);
                showAlert('即時同步發生錯誤，請重新整理頁面。', 'danger');
                showDataLoading(false);
            });
        }

        // 儲存施工記錄
        async function saveConstructionRecord() {
            if (!currentUser) {
                showAlert('請先登入！', 'danger');
                return;
            }

            const form = document.getElementById('constructionForm');
            const saveBtn = document.getElementById('saveBtn');

            // 驗證必填欄位
            if (!form.projectName.value.trim() || !form.date.value || 
                !form.workItem.value || !form.completedQuantity.value || 
                !form.totalWorkers.value) {
                showAlert('請填寫所有必填欄位（標示*者）！', 'danger');
                return;
            }

            // 收集材料資料
            const materialNames = form.querySelectorAll('input[name="materialName[]"]');
            const materialQuantities = form.querySelectorAll('input[name="materialQuantity[]"]');
            const materialUnits = form.querySelectorAll('input[name="materialUnit[]"]');
            const materialSuppliers = form.querySelectorAll('input[name="materialSupplier[]"]');
            
            const materials = [];
            for (let i = 0; i < materialNames.length; i++) {
                if (materialNames[i].value.trim()) {
                    materials.push({
                        name: materialNames[i].value,
                        quantity: parseFloat(materialQuantities[i].value) || 0,
                        unit: materialUnits[i].value || '',
                        supplier: materialSuppliers[i].value || ''
                    });
                }
            }

            const recordData = {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                userName: currentUser.displayName || '未知使用者',
                projectName: form.projectName.value,
                projectLocation: form.projectLocation.value || '',
                date: form.date.value,
                weather: form.weather.value || '',
                supervisor: form.supervisor.value || '',
                shift: form.shift.value || '',
                workItem: form.workItem.value,
                workDetail: form.workDetail.value || '',
                completedQuantity: parseFloat(form.completedQuantity.value),
                unit: form.unit.value || '',
                totalWorkers: parseInt(form.totalWorkers.value),
                skilledWorkers: parseInt(form.skilledWorkers.value) || 0,
                laborWorkers: parseInt(form.laborWorkers.value) || 0,
                overtimeHours: parseFloat(form.overtimeHours.value) || 0,
                materials: materials,
                notes: form.notes.value || '',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                saveBtn.disabled = true;
                saveBtn.innerHTML = '💾 儲存中...';
                setSyncStatus('syncing');

                if (currentEditId) {
                    // 更新現有記錄
                    await db.collection('construction_records').doc(currentEditId).update({
                        ...recordData,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showAlert('✅ 施工記錄更新成功！', 'success');
                    currentEditId = null;
                } else {
                    // 新增記錄
                    await db.collection('construction_records').add(recordData);
                    showAlert('✅ 施工記錄儲存成功！', 'success');
                }

                clearForm();
                setSyncStatus('online');

            } catch (error) {
                console.error('Save error:', error);
                let message = '儲存失敗！';
                
                if (error.code === 'permission-denied') {
                    message = '權限不足，請重新登入。';
                } else if (error.code === 'unavailable') {
                    message = '網路連線不穩定，請稍後重試。';
                } else {
                    message = `儲存失敗：${error.message}`;
                }
                
                showAlert(message, 'danger');
                setSyncStatus('offline');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '💾 儲存至雲端';
            }
        }

        // 載入所有資料到表格
        function loadAllData() {
            const tbody = document.getElementById('dataTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (constructionData.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tbody.innerHTML = constructionData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.projectName}</td>
                    <td>${item.date}</td>
                    <td>${item.workItem}${item.workDetail ? '<br><small>' + item.workDetail + '</small>' : ''}</td>
                    <td>${item.completedQuantity} ${item.unit || ''}</td>
                    <td>${item.totalWorkers}人${item.overtimeHours ? '<br><small>加班' + item.overtimeHours + 'h</small>' : ''}</td>
                    <td>${item.weather || '-'}</td>
                    <td>${item.supervisor || '-'}</td>
                    <td>${item.materials ? item.materials.length : 0}項</td>
                    <td>${formatDate(item.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="viewDetails('${item.id}')">詳情</button>
                            <button class="btn btn-warning" onclick="editData('${item.id}')">編輯</button>
                            <button class="btn btn-danger" onclick="deleteData('${item.id}')">刪除</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // 格式化日期
        function formatDate(timestamp) {
            if (!timestamp) return '-';
            
            let date;
            if (timestamp && timestamp.toDate) {
                // Firestore Timestamp
                date = timestamp.toDate();
            } else if (timestamp instanceof Date) {
                date = timestamp;
            } else {
                date = new Date(timestamp);
            }
            
            return date.toLocaleString('zh-TW');
        }

        // 查看詳情
        function viewDetails(id) {
            const item = constructionData.find(data => data.id === id);
            if (!item) return;

            let materialsInfo = '';
            if (item.materials && item.materials.length > 0) {
                materialsInfo = item.materials.map(m => 
                    `${m.name}: ${m.quantity} ${m.unit} (${m.supplier || '未指定供應商'})`
                ).join('\n');
            } else {
                materialsInfo = '無材料記錄';
            }

            const details = `
工程名稱: ${item.projectName}
工程地點: ${item.projectLocation || '未指定'}
施工日期: ${item.date}
天氣狀況: ${item.weather || '未記錄'}
監工人員: ${item.supervisor || '未指定'}
施工班次: ${item.shift || '未指定'}

施工項目: ${item.workItem}
施工細項: ${item.workDetail || '無'}
完成數量: ${item.completedQuantity} ${item.unit || ''}

人力配置:
- 總出工人數: ${item.totalWorkers}人
- 技術工人: ${item.skilledWorkers || 0}人
- 普工: ${item.laborWorkers || 0}人
- 加班時數: ${item.overtimeHours || 0}小時

材料進場:
${materialsInfo}

備註: ${item.notes || '無'}

記錄者: ${item.userName || '未知'}
建立時間: ${formatDate(item.createdAt)}
            `;

            alert(details);
        }

        // 編輯資料
        function editData(id) {
            const item = constructionData.find(data => data.id === id);
            if (!item) return;

            const form = document.getElementById('constructionForm');
            form.projectName.value = item.projectName || '';
            form.projectLocation.value = item.projectLocation || '';
            form.date.value = item.date;
            form.weather.value = item.weather || '';
            form.supervisor.value = item.supervisor || '';
            form.shift.value = item.shift || '';
            form.workItem.value = item.workItem;
            form.workDetail.value = item.workDetail || '';
            form.completedQuantity.value = item.completedQuantity;
            form.unit.value = item.unit || '';
            form.totalWorkers.value = item.totalWorkers;
            form.skilledWorkers.value = item.skilledWorkers || '';
            form.laborWorkers.value = item.laborWorkers || '';
            form.overtimeHours.value = item.overtimeHours || '';
            form.notes.value = item.notes || '';

            // 載入材料資料
            const materialsList = document.getElementById('materialsList');
            materialsList.innerHTML = '';
            
            if (item.materials && item.materials.length > 0) {
                item.materials.forEach(material => {
                    const materialItem = document.createElement('div');
                    materialItem.className = 'material-item';
                    materialItem.innerHTML = `
                        <input type="text" placeholder="材料名稱" name="materialName[]" value="${material.name}" style="flex: 2;">
                        <input type="number" placeholder="數量" name="materialQuantity[]" value="${material.quantity}" min="0" step="0.1" style="flex: 1;">
                        <input type="text" placeholder="單位" name="materialUnit[]" value="${material.unit}" style="flex: 1;">
                        <input type="text" placeholder="供應商" name="materialSupplier[]" value="${material.supplier}" style="flex: 1.5;">
                        <button type="button" class="btn btn-danger" onclick="removeMaterialItem(this)" style="padding: 8px 12px; font-size: 12px;">刪除</button>
                    `;
                    materialsList.appendChild(materialItem);
                });
            } else {
                addMaterialItem();
            }

            currentEditId = id;
            switchTab('daily');
            
            showAlert('✏️ 資料載入完成，修改後請點擊儲存', 'info');
        }

        // 刪除資料
        async function deleteData(id) {
            if (!confirm('確定要刪除這筆施工記錄嗎？')) return;
            
            try {
                setSyncStatus('syncing');
                await db.collection('construction_records').doc(id).delete();
                showAlert('🗑️ 施工記錄已刪除', 'success');
                setSyncStatus('online');
            } catch (error) {
                console.error('Delete error:', error);
                showAlert('刪除失敗！', 'danger');
                setSyncStatus('offline');
            }
        }

        // 更新統計資料
        function updateStats() {
            const totalRecords = constructionData.length;
            const totalWorkers = constructionData.reduce((sum, item) => sum + (item.totalWorkers || 0), 0);
            const avgWorkersPerDay = totalRecords > 0 ? Math.round(totalWorkers / totalRecords) : 0;
            const totalProjects = [...new Set(constructionData.map(item => item.projectName))].length;

            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('totalWorkers').textContent = totalWorkers;
            document.getElementById('avgWorkersPerDay').textContent = avgWorkersPerDay;
            document.getElementById('totalProjects').textContent = totalProjects;

            updateWorkItemStats();
            updateProjectStats();
        }

        // 更新施工項目統計
        function updateWorkItemStats() {
            const workItemStats = document.getElementById('workItemStats');
            
            if (constructionData.length === 0) {
                workItemStats.innerHTML = '<p style="text-align: center; color: #666;">暫無施工數據</p>';
                return;
            }

            const itemCounts = {};
            constructionData.forEach(item => {
                itemCounts[item.workItem] = (itemCounts[item.workItem] || 0) + 1;
            });

            const sortedItems = Object.entries(itemCounts)
                .sort(([,a], [,b]) => b - a)
                .map(([name, count]) => ({
                    name,
                    count,
                    percentage: Math.round((count / constructionData.length) * 100)
                }));

            workItemStats.innerHTML = sortedItems.map(item => `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${item.name}</span>
                        <span>${item.count} 次 (${item.percentage}%)</span>
                    </div>
                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px;">
                        <div style="background: #4285F4; height: 8px; width: ${item.percentage}%; border-radius: 4px;"></div>
                    </div>
                </div>
            `).join('');
        }

        // 更新工程專案統計
        function updateProjectStats() {
            const projectStats = document.getElementById('projectStats');
            
            if (constructionData.length === 0) {
                projectStats.innerHTML = '<p style="text-align: center; color: #666;">暫無工程數據</p>';
                return;
            }

            const projectCounts = {};
            constructionData.forEach(item => {
                projectCounts[item.projectName] = (projectCounts[item.projectName] || 0) + 1;
            });

            const sortedProjects = Object.entries(projectCounts)
                .sort(([,a], [,b]) => b - a)
                .map(([name, count]) => ({
                    name,
                    count,
                    percentage: Math.round((count / constructionData.length) * 100)
                }));

            projectStats.innerHTML = sortedProjects.map(project => `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${project.name}</span>
                        <span>${project.count} 次 (${project.percentage}%)</span>
                    </div>
                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px;">
                        <div style="background: #34A853; height: 8px; width: ${project.percentage}%; border-radius: 4px;"></div>
                    </div>
                </div>
            `).join('');
        }

        // 切換分頁
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'stats') {
                updateStats();
            }
        }

        // 顯示/隱藏登入註冊表單
        function showSignup() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('signup-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        }

        // 顯示認證載入狀態
        function showAuthLoading(show) {
            document.getElementById('auth-loading').style.display = show ? 'block' : 'none';
            document.getElementById('login-form').style.display = show ? 'none' : 'block';
            document.getElementById('signup-form').style.display = 'none';
        }

        // 顯示資料載入狀態
        function showDataLoading(show) {
            document.getElementById('data-loading').style.display = show ? 'block' : 'none';
        }

        // 設定同步狀態
        function setSyncStatus(status) {
            const syncStatus = document.getElementById('syncStatus');
            if (syncStatus) {
                syncStatus.className = 'sync-indicator sync-' + status;
            }
        }

        // 顯示/隱藏連線狀態
        function showConnectionStatus() {
            const connectionStatus = document.getElementById('connectionStatus');
            connectionStatus.style.display = 'block';
            connectionStatus.className = 'connection-status connection-online';
        }

        function hideConnectionStatus() {
            const connectionStatus = document.getElementById('connectionStatus');
            connectionStatus.style.display = 'none';
        }

        // 監聽連線狀態
        function monitorConnection() {
            setSyncStatus('online');
            showConnectionStatus();
        }

        // 材料管理函數
        function addMaterialItem() {
            const materialsList = document.getElementById('materialsList');
            const materialItem = document.createElement('div');
            materialItem.className = 'material-item';
            materialItem.innerHTML = `
                <input type="text" placeholder="材料名稱" name="materialName[]" style="flex: 2;">
                <input type="number" placeholder="數量" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
                <input type="text" placeholder="單位" name="materialUnit[]" style="flex: 1;">
                <input type="text" placeholder="供應商" name="materialSupplier[]" style="flex: 1.5;">
                <button type="button" class="btn btn-danger" onclick="removeMaterialItem(this)" style="padding: 8px 12px; font-size: 12px;">刪除</button>
            `;
            materialsList.appendChild(materialItem);
        }

        function removeMaterialItem(button) {
            const materialsList = document.getElementById('materialsList');
            if (materialsList.children.length > 1) {
                button.parentElement.remove();
            } else {
                showAlert('至少需要保留一個材料項目！', 'danger');
            }
        }

        // 清空表單
        function clearForm() {
            document.getElementById('constructionForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            currentEditId = null;
            
            // 重置材料列表
            const materialsList = document.getElementById('materialsList');
            materialsList.innerHTML = `
                <div class="material-item">
                    <input type="text" placeholder="材料名稱" name="materialName[]" style="flex: 2;">
                    <input type="number" placeholder="數量" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
                    <input type="text" placeholder="單位" name="materialUnit[]" style="flex: 1;">
                    <input type="text" placeholder="供應商" name="materialSupplier[]" style="flex: 1.5;">
                    <button type="button" class="btn btn-danger" onclick="removeMaterialItem(this)" style="padding: 8px 12px; font-size: 12px;">刪除</button>
                </div>
            `;
        }

        // 顯示提示訊息
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            alertContainer.appendChild(alertDiv);
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // 搜尋和篩選功能
        function searchData() {
            filterData();
        }

        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const projectFilter = document.getElementById('projectFilter').value;
            const itemFilter = document.getElementById('itemFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filteredData = constructionData;

            // 文字搜尋
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.projectName.toLowerCase().includes(searchTerm) ||
                    item.workItem.toLowerCase().includes(searchTerm) ||
                    (item.workDetail && item.workDetail.toLowerCase().includes(searchTerm)) ||
                    (item.supervisor && item.supervisor.toLowerCase().includes(searchTerm)) ||
                    (item.notes && item.notes.toLowerCase().includes(searchTerm))
                );
            }

            // 工程篩選
            if (projectFilter) {
                filteredData = filteredData.filter(item => item.projectName === projectFilter);
            }

            // 項目篩選
            if (itemFilter) {
                filteredData = filteredData.filter(item => item.workItem === itemFilter);
            }

            // 日期篩選
            if (dateFilter) {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                
                filteredData = filteredData.filter(item => {
                    const itemDate = new Date(item.date);
                    
                    switch(dateFilter) {
                        case 'today':
                            return item.date === todayStr;
                        case 'week':
                            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return itemDate >= weekAgo && itemDate <= today;
                        case 'month':
                            return itemDate.getMonth() === today.getMonth() && 
                                   itemDate.getFullYear() === today.getFullYear();
                        default:
                            return true;
                    }
                });
            }

            // 更新表格顯示
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = filteredData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.projectName}</td>
                    <td>${item.date}</td>
                    <td>${item.workItem}${item.workDetail ? '<br><small>' + item.workDetail + '</small>' : ''}</td>
                    <td>${item.completedQuantity} ${item.unit || ''}</td>
                    <td>${item.totalWorkers}人${item.overtimeHours ? '<br><small>加班' + item.overtimeHours + 'h</small>' : ''}</td>
                    <td>${item.weather || '-'}</td>
                    <td>${item.supervisor || '-'}</td>
                    <td>${item.materials ? item.materials.length : 0}項</td>
                    <td>${formatDate(item.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="viewDetails('${item.id}')">詳情</button>
                            <button class="btn btn-warning" onclick="editData('${item.id}')">編輯</button>
                            <button class="btn btn-danger" onclick="deleteData('${item.id}')">刪除</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateFilters() {
            // 更新工程篩選
            const projectFilter = document.getElementById('projectFilter');
            const projectNames = [...new Set(constructionData.map(item => item.projectName))];
            
            const currentProjectValue = projectFilter.value;
            projectFilter.innerHTML = '<option value="">全部工程</option>';
            
            projectNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                projectFilter.appendChild(option);
            });
            projectFilter.value = currentProjectValue;

            // 更新項目篩選
            const itemFilter = document.getElementById('itemFilter');
            const workItems = [...new Set(constructionData.map(item => item.workItem))];
            
            const currentItemValue = itemFilter.value;
            itemFilter.innerHTML = '<option value="">全部項目</option>';
            
            workItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                itemFilter.appendChild(option);
            });
            itemFilter.value = currentItemValue;
        }

        function exportToExcel() {
            if (constructionData.length === 0) {
                showAlert('沒有資料可以匯出！', 'danger');
                return;
            }

            const exportData = [];
            
            constructionData.forEach((item, index) => {
                const baseData = {
                    '編號': index + 1,
                    '工程名稱': item.projectName,
                    '工程地點': item.projectLocation || '',
                    '施工日期': item.date,
                    '天氣狀況': item.weather || '',
                    '監工人員': item.supervisor || '',
                    '施工班次': item.shift || '',
                    '施工項目': item.workItem,
                    '施工細項': item.workDetail || '',
                    '完成數量': item.completedQuantity,
                    '單位': item.unit || '',
                    '總出工人數': item.totalWorkers,
                    '技術工人數': item.skilledWorkers || 0,
                    '普工人數': item.laborWorkers || 0,
                    '加班時數': item.overtimeHours || 0,
                    '材料項目數': item.materials ? item.materials.length : 0,
                    '備註': item.notes || '',
                    '記錄者': item.userName || '',
                    '記錄時間': formatDate(item.createdAt)
                };

                exportData.push(baseData);

                // 如果有材料資料，另外建立材料明細表
                if (item.materials && item.materials.length > 0) {
                    item.materials.forEach(material => {
                        exportData.push({
                            '編號': `${index + 1}-材料`,
                            '工程名稱': item.projectName,
                            '施工日期': item.date,
                            '材料名稱': material.name,
                            '材料數量': material.quantity,
                            '材料單位': material.unit,
                            '供應商': material.supplier || ''
                        });
                    });
                }
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // 設定欄位寬度
            const colWidths = [
                {wch: 8}, {wch: 20}, {wch: 15}, {wch: 12}, {wch: 10}, 
                {wch: 12}, {wch: 12}, {wch: 15}, {wch: 20}, {wch: 10}, 
                {wch: 8}, {wch: 10}, {wch: 10}, {wch: 10}, {wch: 10}, 
                {wch: 8}, {wch: 30}, {wch: 15}, {wch: 18}
            ];
            ws['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(wb, ws, "施工記錄");
            const fileName = `施工記錄_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert('Excel檔案已成功匯出！', 'success');
        }

        function clearAllData() {
            if (!confirm('確定要清空所有資料嗎？此操作無法復原！')) return;
            
            showAlert('此功能將刪除雲端所有資料，請謹慎使用。如需清空，請聯繫系統管理員。', 'info');
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase工地管理系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK v9 (舊版相容語法) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            text-align: center;
        }

        .auth-container h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .firebase-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFA000 0%, #FF6F00 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4285F4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            position: relative;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
            color: white;
            width: 100%;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e0e0e0;
            width: 100%;
        }

        .btn-success {
            background: linear-gradient(135deg, #34A853 0%, #137333 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #EA4335 0%, #D33B2C 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #FBBC04 0%, #F9AB00 100%);
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-left p {
            opacity: 0.9;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
        }

        .user-email {
            font-size: 12px;
            opacity: 0.8;
        }

        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            font-size: 12px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #4285F4;
            border-bottom: 3px solid #4285F4;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #4285F4;
        }

        .form-section h3 {
            color: #4285F4;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #4285F4;
        }

        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #4285F4;
            margin-bottom: 8px;
        }

        .stats-label {
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 13px;
        }

        .data-table th,
        .data-table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
            font-size: 12px;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .table-container {
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .search-filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box, .filter-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
        }

        .search-box {
            min-width: 300px;
            flex: 1;
        }

        .filter-select {
            min-width: 120px;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
            font-size: 14px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #cce7f0;
            color: #055160;
            border: 1px solid #b3d7e6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4285F4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            display: none;
        }

        .connection-online {
            background: #34A853;
            color: white;
        }

        .connection-offline {
            background: #EA4335;
            color: white;
        }

        .material-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .material-item input {
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 4px;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            padding: 6px 12px;
            font-size: 11px;
            margin: 2px;
        }

        .sync-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .sync-online {
            background: #34A853;
            box-shadow: 0 0 5px #34A853;
        }

        .sync-syncing {
            background: #FBBC04;
            animation: pulse 1s infinite;
        }

        .sync-offline {
            background: #EA4335;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- 登入介面 -->
    <div id="auth-container" class="auth-container">
        <div id="login-form">
            <h2>🏗️ Firebase工地管理系統</h2>
            <div class="firebase-badge">🔥 Firebase驅動</div>
            <p class="auth-subtitle">雲端同步・即時協作・安全可靠</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label>電子信箱</label>
                    <input type="email" id="loginEmail" required placeholder="請輸入電子信箱">
                </div>
                <div class="form-group">
                    <label>密碼</label>
                    <input type="password" id="loginPassword" required placeholder="請輸入密碼">
                </div>
                <button type="submit" class="btn btn-primary" id="loginBtn">登入系統</button>
                <button type="button" class="btn btn-secondary" onclick="showSignup()">註冊新帳號</button>
            </form>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; font-size: 12px; color: #999;">
                <p>💡 <strong>測試用帳號</strong></p>
                <p>信箱: demo@test.com</p>
                <p>密碼: 123456</p>
            </div>
        </div>

        <div id="signup-form" style="display: none;">
            <h2>註冊新帳號</h2>
            <div class="firebase-badge">🔥 Firebase驅動</div>
            <p class="auth-subtitle">建立您的工地管理帳號</p>
            
            <form id="signupForm">
                <div class="form-group">
                    <label>姓名</label>
                    <input type="text" id="signupName" required placeholder="請輸入姓名">
                </div>
                <div class="form-group">
                    <label>電子信箱</label>
                    <input type="email" id="signupEmail" required placeholder="請輸入電子信箱">
                </div>
                <div class="form-group">
                    <label>密碼</label>
                    <input type="password" id="signupPassword" required placeholder="請輸入密碼（至少6位）">
                </div>
                <div class="form-group">
                    <label>電話號碼</label>
                    <input type="tel" id="signupPhone" placeholder="請輸入電話號碼">
                </div>
                <button type="submit" class="btn btn-primary" id="signupBtn">註冊帳號</button>
                <button type="button" class="btn btn-secondary" onclick="showLogin()">已有帳號？登入</button>
            </form>
        </div>

        <div id="auth-loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>處理中...</p>
        </div>
    </div>

    <!-- 主要應用程式介面 -->
    <div class="container" id="main-app">
        <div class="header">
            <div class="header-left">
                <h1>🏗️ Firebase工地管理系統</h1>
                <p>即時同步・雲端儲存・多人協作<span class="sync-indicator sync-online" id="syncStatus"></span></p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-name" id="userName"></div>
                    <div class="user-email" id="userEmail"></div>
                </div>
                <button class="btn btn-logout" onclick="logout()">登出</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('daily')">📝 每日施工記錄</button>
            <button class="tab" onclick="switchTab('manage')">📋 施工數據管理</button>
            <button class="tab" onclick="switchTab('stats')">📈 進度統計分析</button>
        </div>

        <!-- 每日施工記錄頁面 -->
        <div id="daily-tab" class="tab-content active">
            <form id="constructionForm">
                <!-- 基本資訊區域 -->
                <div class="form-section">
                    <h3>🗓️ 基本資訊</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectName">工程名稱 *</label>
                            <input type="text" id="projectName" name="projectName" placeholder="請輸入工程名稱" required>
                        </div>
                        <div class="form-group">
                            <label for="date">施工日期 *</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="weather">天氣狀況</label>
                            <select id="weather" name="weather">
                                <option value="">請選擇天氣</option>
                                <option value="晴天">☀️ 晴天</option>
                                <option value="多雲">⛅ 多雲</option>
                                <option value="陰天">☁️ 陰天</option>
                                <option value="小雨">🌦️ 小雨</option>
                                <option value="大雨">🌧️ 大雨</option>
                                <option value="颱風">🌀 颱風</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectLocation">工程地點</label>
                            <input type="text" id="projectLocation" name="projectLocation" placeholder="請輸入施工地點">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="supervisor">監工人員</label>
                            <input type="text" id="supervisor" name="supervisor" placeholder="請輸入監工姓名">
                        </div>
                        <div class="form-group">
                            <label for="shift">施工班次</label>
                            <select id="shift" name="shift">
                                <option value="">請選擇班次</option>
                                <option value="日班">🌅 日班 (08:00-17:00)</option>
                                <option value="夜班">🌙 夜班 (20:00-05:00)</option>
                                <option value="全日班">⏰ 全日班</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 施工項目區域 -->
                <div class="form-section">
                    <h3>🔨 施工項目與進度</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="workItem">施工項目 *</label>
                            <select id="workItem" name="workItem" required>
                                <option value="">請選擇施工項目</option>
                                <option value="基礎工程">🏗️ 基礎工程</option>
                                <option value="鋼筋工程">🔗 鋼筋工程</option>
                                <option value="混凝土工程">🧱 混凝土工程</option>
                                <option value="模板工程">📐 模板工程</option>
                                <option value="砌磚工程">🧱 砌磚工程</option>
                                <option value="水電工程">⚡ 水電工程</option>
                                <option value="油漆工程">🎨 油漆工程</option>
                                <option value="裝修工程">🔧 裝修工程</option>
                                <option value="其他">❓ 其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="workDetail">施工細項</label>
                            <input type="text" id="workDetail" name="workDetail" placeholder="例如：一樓柱子澆置">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="completedQuantity">完成數量 *</label>
                            <input type="number" id="completedQuantity" name="completedQuantity" min="0" step="0.1" placeholder="請輸入完成數量" required>
                        </div>
                        <div class="form-group">
                            <label for="unit">單位</label>
                            <select id="unit" name="unit">
                                <option value="">請選擇單位</option>
                                <option value="立方米">立方米 (m³)</option>
                                <option value="平方米">平方米 (m²)</option>
                                <option value="公尺">公尺 (m)</option>
                                <option value="支">支</option>
                                <option value="組">組</option>
                                <option value="式">式</option>
                                <option value="批">批</option>
                                <option value="項">項</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 人力配置區域 -->
                <div class="form-section">
                    <h3>👷 人力配置</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="totalWorkers">總出工人數 *</label>
                            <input type="number" id="totalWorkers" name="totalWorkers" min="0" placeholder="請輸入總人數" required>
                        </div>
                        <div class="form-group">
                            <label for="skilledWorkers">技術工人數</label>
                            <input type="number" id="skilledWorkers" name="skilledWorkers" min="0" placeholder="技術工人數">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="laborWorkers">普工人數</label>
                            <input type="number" id="laborWorkers" name="laborWorkers" min="0" placeholder="普工人數">
                        </div>
                        <div class="form-group">
                            <label for="overtimeHours">加班時數</label>
                            <input type="number" id="overtimeHours" name="overtimeHours" min="0" step="0.5" placeholder="加班時數">
                        </div>
                    </div>
                </div>

                <!-- 材料進場區域 -->
                <div class="form-section">
                    <h3>📦 材料進場記錄</h3>
                    <button type="button" class="btn btn-success" onclick="addMaterialItem()" style="margin-bottom: 15px;">+ 新增材料</button>
                    <div id="materialsList">
                        <div class="material-item">
                            <input type="text" placeholder="材料名稱" name="materialName[]" style="flex: 2;">
                            <input type="number" placeholder="數量" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
                            <input type="text" placeholder="單位" name="materialUnit[]" style="flex: 1;">
                            <input type="text" placeholder="供應商" name="materialSupplier[]" style="flex: 1.5;">
                            <button type="button" class="btn btn-danger" onclick="removeMaterialItem(this)" style="padding: 8px 12px; font-size: 12px;">刪除</button>
                        </div>
                    </div>
                </div>

                <!-- 備註區域 -->
                <div class="form-section">
                    <h3>📝 備註說明</h3>
                    <div class="form-group">
                        <label for="notes">施工備註</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="請輸入施工狀況、問題或特殊事項..."></textarea>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button type="button" class="btn btn-primary" onclick="saveConstructionRecord()" id="saveBtn">
                        💾 儲存至雲端
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">🗑️ 清空表單</button>
                </div>
            </form>

            <div id="alert-container"></div>
        </div>

        <!-- 施工數據管理頁面 -->
        <div id="manage-tab" class="tab-content">
            <div class="search-filter-bar">
                <input type="text" class="search-box" id="searchInput" placeholder="🔍 搜尋工程名稱、施工項目..." onkeyup="searchData()">
                <select class="filter-select" id="projectFilter" onchange="filterData()">
                    <option value="">全部工程</option>
                </select>
                <select class="filter-select" id="itemFilter" onchange="filterData()">
                    <option value="">全部項目</option>
                </select>
                <select class="filter-select" id="dateFilter" onchange="filterData()">
                    <option value="">全部日期</option>
                    <option value="today">今日</option>
                    <option value="week">本週</option>
                    <option value="month">本月</option>
                </select>
                <div>
                    <button class="btn btn-success" onclick="exportToExcel()">📊 匯出Excel</button>
                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ 清空資料</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>編號</th>
                            <th>工程名稱</th>
                            <th>日期</th>
                            <th>施工項目</th>
                            <th>完成數量</th>
                            <th>出工人數</th>
                            <th>天氣</th>
                            <th>監工</th>
                            <th>材料進場</th>
                            <th>記錄時間</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
                
                <div id="emptyState" class="empty-state">
                    <div style="font-size: 48px;">🏗️</div>
                    <h3>尚未有施工記錄</h3>
                    <p>點擊「每日施工記錄」開始記錄第一筆資料</p>
                    <p style="color: #4285F4; margin-top: 10px;">🔥 資料將即時同步至Firebase雲端</p>
                </div>
            </div>

            <div id="data-loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>從雲端載入資料中...</p>
            </div>
        </div>


	// 切換分頁
	function switchTab(tabName) {
    	const tabs = document.querySelectorAll('.tab-content');
    	tabs.forEach(tab => tab.classList.remove('active'));
    
    	const tabButtons = document.querySelectorAll('.tab');
    	tabButtons.forEach(btn => btn.classList.remove('active'));
    
    	document.getElementById(tabName + '-tab').classList.add('active');
    	event.target.classList.add('active');
    
    	if (tabName === 'stats') {
        updateStats();
    	}
	}

	// 顯示/隱藏登入註冊表單
	function showSignup() {
	    document.getElementById('login-form').style.display = 'none';
	    document.getElementById('signup-form').style.display = 'block';
	}

	function showLogin() {
	    document.getElementById('signup-form').style.display = 'none';
	    document.getElementById('login-form').style.display = 'block';
	}

	// 顯示認證載入狀態
	function showAuthLoading(show) {
	    document.getElementById('auth-loading').style.display = show ? 'block' : 'none';
	    document.getElementById('login-form').style.display = show ? 'none' : 'block';
	    document.getElementById('signup-form').style.display = 'none';
	}

	// 顯示資料載入狀態
	function showDataLoading(show) {
	    document.getElementById('data-loading').style.display = show ? 'block' : 'none';
	}

	// 設定同步狀態
	function setSyncStatus(status) {
	    const syncStatus = document.getElementById('syncStatus');
	    syncStatus.className = 'sync-indicator sync-' + status;
	}

	// 顯示/隱藏連線狀態
	function showConnectionStatus() {
	    document.getElementById('connectionStatus').style.display = 'block';
	    document.getElementById('connectionStatus').className = 'connection-status connection-online';
	}

	function hideConnectionStatus() {
	    document.getElementById('connectionStatus').style.display = 'none';
	}

	// 監聽連線狀態
	function monitorConnection() {
	    setSyncStatus('online');
	    showConnectionStatus();
	}

	// 材料管理函數
	function addMaterialItem() {
	    const materialsList = document.getElementById('materialsList');
	    const materialItem = document.createElement('div');
	    materialItem.className = 'material-item';
	    materialItem.innerHTML = `
        	<input type="text" placeholder="材料名稱" name="materialName[]" style="flex: 2;">
        	<input type="number" placeholder="數量" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
        	<input type="text" placeholder="單位" name="materialUnit[]" style="flex: 1;">
        	<input type="text" placeholder="供應商" name="materialSupplier[]" style="flex: 1.5;">
        	<button type="button" class="btn btn-danger" onclick="removeMaterialItem(this)" style="padding: 8px 12px; font-size: 12px;">刪除</button>
	    `;
	    materialsList.appendChild(materialItem);
	}

	function removeMaterialItem(button) {
	    const materialsList = document.getElementById('materialsList');
	    if (materialsList.children.length > 1) {
	        button.parentElement.remove();
	    } else {
	        showAlert('至少需要保留一個材料項目！', 'danger');
	    }
	}

	// 清空表單
	function clearForm() {
	    document.getElementById('constructionForm').reset();
	    document.getElementById('date').value = new Date().toISOString().split('T')[0];
	    currentEditId = null;
    
 	   // 重置材料列表
 	   const materialsList = document.getElementById('materialsList');
	    materialsList.innerHTML = `
 	       <div class="material-item">
	            <input type="text" placeholder="材料名稱" name="materialName[]" style="flex: 2;">
	            <input type="number" placeholder="數量" name="materialQuantity[]" min="0" step="0.1" style="flex: 1;">
	            <input type="text" placeholder="單位" name="materialUnit[]" style="flex: 1;">
	            <input type="text" placeholder="供應商" name="materialSupplier[]" style="flex: 1.5;">
	            <button type="button" class="btn btn-danger" onclick="removeMaterialItem(this)" style="padding: 8px 12px; font-size: 12px;">刪除</button>
	        </div>
	    `;
	}

	// 顯示提示訊息
	function showAlert(message, type) {
	    const alertContainer = document.getElementById('alert-container');
	    const alertDiv = document.createElement('div');
	    alertDiv.className = `alert alert-${type}`;
	    alertDiv.textContent = message;
    
	    alertContainer.appendChild(alertDiv);
	    alertDiv.style.display = 'block';
    
	    setTimeout(() => {
	        alertDiv.remove();
	    }, 3000);
	}

	// 搜尋和篩選功能（暫時用空函數）
	function searchData() {
	    // 搜尋功能實作
	}

	function filterData() {
	    // 篩選功能實作
	}

	function updateFilters() {
 	   // 更新篩選選項
	}

	function exportToExcel() {
	    showAlert('匯出功能開發中...', 'info');
	}

	function clearAllData() {
	    if (confirm('確定要清空所有資料嗎？')) {
	        showAlert('清空功能開發中...', 'info');
	    }
	}
